<!DOCTYPE html PUBLIC "-//W3C//DTD Html 1.0 Strict//EN" "http://www.w3.org/TR/Html1/DTD/strict.dtd">
<html><head>
<title>SpatialDistributions</title>

<link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" rel="stylesheet"/>
<script crossorigin="anonymous" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<link href="/css/bootstrap.css" rel="stylesheet"/>
<link href="images/favicon.ico" rel="icon" type="image/x-icon"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
</head>
<body>
<nav class="navbar navbar-expand sticky-top navbar-light bg-light">
<a class="navbar-brand" href="/"><img src="/images/logo.svg"/>MultiBUGS</a>
<div class="collapse navbar" id="navbarSupportedContent">
<ul class="navbar-nav mr-auto">
<li class="nav-item">
<a class="nav-link" href="/">Home</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/about">About</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/download">Download</a>
</li>
<li class="nav-item active">
<a class="nav-link" href="/documentation/latest/">Documentation <span class="sr-only">(current)</span></a>
</li>
<li class="nav-item">
<a class="nav-link" href="/examples/latest/">Examples</a>
</li>
</ul>
</div>
</nav><div class="container-fluid"><div class="row main"><div class="col-md-3 col-lg-2 col-xl-3"><div class="sticky-top stickymenu" id="contents">
<button aria-controls="navbarContents" aria-expanded="false" aria-label="Toggle docs navigation" class="btn btn-link d-md-none ml-3 mr-3 mt-3 collapsed mb-toggler" data-target="#navbarContents" data-toggle="collapse" type="button">
<span class="mb-toggler-icon mr-1"></span>
    Contents
  </button>

<h5 class="d-none d-md-block">Contents</h5>
<div class="collapse mb-links" id="navbarContents">
<ul class="list-unstyled">
<li class="nav-item"><a aria-expanded="true" class="dropdown-toggle nav-link" data-toggle="collapse" href="#basics">Basics</a>
<ul class="collapse" id="basics">
<li><a href="/documentation/latest/Introduction.html">Introduction</a></li>
<li><a href="/documentation/latest/Tutorial.html">Tutorial</a></li>
<li><a href="/documentation/latest/CompoundDocuments.html">Compound documents</a></li>
<li><a href="/documentation/latest/Graphics.html">Graphics</a></li>
<li><a href="/documentation/latest/DoodleBUGS.html">DoodleBUGS</a></li>
<li><a href="/documentation/latest/Scripts.html">Scripts</a></li>
</ul>
</li>
<li class="nav-item"><a aria-expanded="true" class="dropdown-toggle nav-link" data-toggle="collapse" href="#language">BUGS language</a>
<ul class="collapse" id="language">
<li><a href="/documentation/latest/ModelSpecification.html">Model specification</a></li>
<li><a href="/documentation/latest/Distributions.html">Distributions</a></li>
<li><a href="/documentation/latest/Functions.html">Functions and functionals</a></li>
<li><a href="/documentation/latest/Tricks.html">Advanced uses</a></li>
<li><a href="/documentation/latest/TipsTroubleshooting.html">Tips and troubleshooting</a></li>
</ul>
</li>
<li class="nav-item"><a aria-expanded="true" class="dropdown-toggle nav-link" data-toggle="collapse" href="#menus">Menus</a>
<ul class="collapse" id="menus">
<li><a href="/documentation/latest/FileMenu.html">File</a></li>
<li><a href="/documentation/latest/EditMenu.html">Edit</a></li>
<li><a href="/documentation/latest/AttributesMenu.html">Attributes</a></li>
<li><a href="/documentation/latest/ToolsMenu.html">Tools</a></li>
<li><a href="/documentation/latest/TextMenu.html">Text</a></li>
<li><a href="/documentation/latest/InfoMenu.html">Info</a></li>
<li><a href="/documentation/latest/ModelMenu.html">Model</a></li>
<li><a href="/documentation/latest/InferenceMenu.html">Inference</a></li>
<li><a href="/documentation/latest/DoodleMenu.html">Doodle</a></li>
<li><a href="/documentation/latest/MapMenu.html">Map</a></li>
<li><a href="/documentation/latest/ExamplesMenu.html">Examples</a></li>
<li><a href="/documentation/latest/ManualsMenu.html">Manuals</a></li>
<li><a href="/documentation/latest/HelpMenu.html">Help</a></li>
</ul>
</li>
<li class="nav-item"><a aria-expanded="true" class="dropdown-toggle nav-link" data-toggle="collapse" href="#geobugs">GeoBUGS</a>
<ul class="collapse show" id="geobugs">
<li><a href="/documentation/latest/spatial/Manual.html">Introduction</a></li>
<li><a href="/documentation/latest/spatial/ImportExport.html">Importing/exporting maps</a></li>
<li><a href="/documentation/latest/spatial/AdjacencyMatrices.html">Adjacency matrices</a></li>
<li><a href="/documentation/latest/spatial/Maps.html">Creating maps</a></li>
<li>Spatial distributions</li>
<li><a href="/documentation/latest/spatial/TemporalDistributions.html">Temporal distributions</a></li>
</ul>
</li>
<li class="nav-item"><a aria-expanded="true" class="dropdown-toggle nav-link" data-toggle="collapse" href="#reliability">ReliaBUGS</a>
<ul class="collapse" id="reliability">
<li><a href="/documentation/latest/reliability/Contents.html">Introduction</a></li>
<li><a href="/documentation/latest/reliability/Analysis.html">Basics</a></li>
<li><a href="/documentation/latest/reliability/Distributions.html">Distributions</a></li>
<li><a href="/documentation/latest/reliability/Functions.html">Logical functions</a></li>
<li><a href="/documentation/latest/reliability/References.html">References</a></li>
</ul>
</li>
<li class="nav-item"><a aria-expanded="true" class="dropdown-toggle nav-link" data-toggle="collapse" href="#developer">Developer</a>
<ul class="collapse" id="developer">
<li><a href="/documentation/latest/developer/Manual.html">Contents</a></li>
<li><a href="/documentation/latest/developer/Tools.html">Setting up the development tools</a></li>
<li><a href="/documentation/latest/developer/Compiling.html">Compiling the Source Code</a></li>
<li><a href="/documentation/latest/developer/Initializing.html">Initializing OpenBUGS</a></li>
<li><a href="/documentation/latest/developer/WritingBUGSExtensions.html">Writing OpenBUGS extensions</a></li>
<li><a href="/documentation/latest/developer/SamplingAlgorithms.html">Sampling algorithms</a></li>
<li><a href="/documentation/latest/developer/BlueDiamonds.html">Blue diamonds</a></li>
<li><a href="/documentation/latest/developer/SoftDocu.html">Bugs subsystems</a></li>
<li><a href="/documentation/latest/developer/Distributing.html">Distributing OpenBUGS</a></li>
</ul>
</li>
<!--<li><a href="/documentation/latest/References.html">References</a>-->
</ul>
</div>
</div></div><div class="col-12 col-md-9 col-lg-7 col-xl-6">


<p>
<h4>Spatial distributions</h4><h5 id="GeneralProperties">Introduction</h5><br/>See <a href="#Appendix"></a><a href="#Appendix">appendices</a> for further tecnhical details about the various spatial distributions implemented in GeoBUGS 1.2.<h5 id="car.normal">car.normal and car.l1</h5><br/><br/>The intrinsic Gaussian CAR prior distribution is specified using the distribution <code>car.normal</code> for the vector of random varables S = (S<sub>1</sub>, ....., S<sub>N</sub>). A robust version of this model is available, which assumes a double exponential (Laplace) rather than Gaussian distribution: this is called <code>car.l1</code>. The syntax for these distributions is as follows:<br/><br/><code>S[1:N] ~ car.normal(adj[], weights[], num[], tau)<br/>S[1:N] ~ car.l1(adj[], weights[], num[], tau)<br/></code><br/>where:<br/><br/><code>adj[]</code> - A vector listing the ID numbers of the adjacent areas for each area (this is a sparse representation of the full adjacency matrix for the study region, and can be generated using the <span class="window_title">Adjacency Tool</span> from the <span class="button">Map</span> menu in GeoBUGS.<br/><code>weights[]</code> - A vector the same length as <code>adj[]</code> giving unnormalised weights associated with each pair of areas. For the CAR model described above, taking C<sub>ij</sub> = 1 (equivalently W<sub>ij</sub> = 1/ n<sub>i</sub> ) if areas i and j are neighbours and 0 otherwise, gives a vector of 1's for <code>weights[]</code>.<br/><code>num[]</code> - A vector of length N (the total number of areas) giving the number of neighbours n<sub>i</sub> for each area.<br/><code>tau</code> - A scalar argument representing the precision (inverse variance) parameter of the Gaussian CAR prior, or the inverse scale parameter of the Laplace prior (for the latter model, the variance = 2 / tau<sup>2</sup>).<br/><br/>The first 3 arguments must be entered as data (it is currently not possible to allow <code>weights[]</code> to be unknown); the final variable <code>tau</code> is usually treated as unknown and so is assigned a prior distribution. The data variables num and adj may be created by the adj matrix option of the <span class="window_title">Adjacency Tool</span> as described in <a href="/documentation/latest/spatial/AdjacencyMatrices.html#Adj"></a><a href="/documentation/latest/spatial/AdjacencyMatrices.html#Adj">Adjacency matrices</a>. The variable <code>weights</code> must be created by the user, and must be a vector the same length as <code>adj</code>. A common choice is to set all the <code>weights</code> equal to 1 since this gives the standard Besag, York and Mollie (1991) CAR model (see section on <a href="#Intrinsic"></a><a href="#Intrinsic">intrinsic CAR models</a> in Appendix 1 for further discussion of weights). The easiest way to do this is to create a loop in your BUGS model code:<br/><br/><code>for (j in 1:sumNumNneigh){ weights[j] &lt;- 1}</code><br/><br/>where <code>sumNumNneigh</code> is the length of <code>adj</code> and is also output by the <span class="button">adj matrix</span> option of the <span class="window_title">Adjacency Tool</span>.<br/><br/>Important things to check when using the <code>car.normal</code> or <code>car.l1</code> distributions:<br/>* The <code>car.normal</code> and <code>car.l1</code> distributions use <strong>unnormalised</strong> weights (see section on <a href="#Intrinsic"></a><a href="#Intrinsic">intrinsic CAR models</a> in Appendix 1).<br/>* <strong>An area cannot be specified as its own neighbour</strong> so make sure the ID number of the area itself does not appear in as one of its list of neighbours in the <code>adj</code> vector. BUGS does not check for this, so it is the user's responsibility. <br/>* The weights must be <strong>symmetric</strong> ( W<sub>ij</sub> = W<sub>ji </sub>). GeoBUGS does carry out a check for this and returns an error message if non-symmetric weights are detected.<br/>* Take care with priors on tau, and be prepared to carry out sensitivity analysis to this choice.<br/>* The car.normal and car.l1 distributions are parameterised to include a <strong>sum-to-zero constraint</strong> on the random effects. This means that you must also include a <strong>separate intercept</strong> term in your model, which MUST be assigned an improper uniform prior using the <code>dflat()</code> distribution.<br/>* Because the car.normal and car.l1 distributions are improper, they can only be used as <strong>prior</strong> distributions, and not as a likelihood.<br/><br/><br/><h5 id="car.proper">car.proper</h5><br/><br/>The proper Gaussian CAR prior distribution is specified using the distribution car.proper for the vector of random variables S = (S<sub>1</sub>, ..., S<sub>N</sub>). The syntax for this distributions is as follows <strong>(NOTE the order of the arguments for car.proper has changed from OpenBUGS/WinBUGS)</strong>:<br/><br/><code>S[1:N] ~ car.proper(adj[], C[], num[], mu[], M[], tau, gamma)</code><br/><br/>where:<br/><br/><code>adj[]</code> - A vector listing the ID numbers of the adjacent areas for each area (this is a sparse representation of the full adjacency matrix for the study region, and can be generated using the <span class="window_title">Adjacency Tool</span> from the <span class="button">Map</span> menu in GeoBUGS.<br/><code>C[]</code> - A vector the same length as adj[] giving normalised weights associated with each pair of areas (see sections on <a href="#Conditional"></a><a href="#Conditional">conditional specification</a> and <a href="#Proper"></a><a href="#Proper">proper CAR priors</a> in Appendix 1). Note that this differs from the intrinsic <code>car.normal</code> or <code>car.l1</code> distributions, where unnormalised weights should be specified. <br/><code>num[]</code> - A vector of length N (the total number of areas) giving the number of neighbours n<sub>i</sub> for each area.<br/><code>mu[]</code> - A vector giving the mean for each area (this can either be entered as data, assigned a prior distribution, or specified deterministically within the model code).<br/><code>M[]</code> - A vector of length N giving the diagonal elements M<sub>ii</sub> of the conditional variance matrix (see sections on <a href="#Conditional"></a><a href="#Conditional">conditional specification</a> and <a href="#Proper"></a><a href="#Proper">proper CAR priors</a> in Appendix 1)<br/><code>tau</code> - A scalar parameter representing the overall precision (inverse variance) parameter.<br/><code>gamma</code> - A scalar parameter representing the overall degree of spatial dependence. This parameter is constrained to lie between bounds given by the inverse of the minimum and maximum eigenvalues of the matrix M<sup>-1/2</sup> C M<sup>1/2 </sup>(see <a href="#Proper"></a><a href="#Proper">appendix 1</a>). BUGS contains two deterministic functions for calculating these bounds (or they can be calculated externally to BUGS and input by the user):<br/><br/><code>min.bound(C[], adj[], num[], M[])<br/>max.bound(C[], adj[], num[], M[])</code><br/><br/>where the arguments are the same as the corresponding vectors used as arguments to the <code>car.proper</code> distribution.<br/><br/>Important things to check when using the <code>car.proper</code> distribution:<br/><br/>* <code>C</code>, <code>adj</code>, <code>num</code> and <code>M</code> must be entered as data (it is currently not possible to allow C to be unknown); <code>num</code> and <code>adj</code> may be created by the <span class="button">adj matrix</span> option of the <span class="window_title">Adjacency Tool</span> as described in <a href="/documentation/latest/spatial/AdjacencyMatrices.html#Adj"></a><a href="/documentation/latest/spatial/AdjacencyMatrices.html#Adj">Adjacency matrices</a>. The <a href="/examples/latest/spatial/Scotland.html"></a><a href="/examples/latest/spatial/Scotland.html">Lips example</a> shows a (slightly clumsy) way of creating the <code>C</code> and <code>M</code> vectors within the BUGS model code; alternatively, these can be created externally to BUGS and read in as data.<br/>* The car.proper distribution uses <strong>normalised</strong> weights C (see section on <a href="#Proper"></a><a href="#Proper">proper CAR priors</a> in Appendix 1).<br/>* <strong>An area cannot be specified as its own neighbour</strong> so make sure the ID number of the area itself does not appear in as one of its list of neighbours in the <code>adj</code> vector. GeoBUGS does not check for this, so it is the user's responsibility. <br/>* The <strong>symmetry constraint</strong> C<sub>ij</sub> M<sub>jj</sub> = C<sub>ji </sub>M<sub>ii </sub>must be satisfied. GeoBUGS does carry out a check for this and returns an error message if lack of symmetry is detected.<br/>* Take care with priors on tau, and be prepared to carry out sensitivity analysis to this choice.<br/><br/>* Take care with priors on gamma: you must ensure that the prior is constrained between the appropriate bounds. Besag, York and Mollie (1991) suggest that gamma needs to be close to its upper bound before it reflects reasonable spatial dependence, so you may want to try informative priors to represent this, and be prepared to carry out sensitivity analysis.<br/><h5 id="spatial.exp">spatial.exp and spatial.disc</h5><br/>Bayesian Gaussian kriging models (multivariate Gaussian distribution with covariance matrix expressed as a parametric function of distance between pairs of points - e.g. see Diggle, Tawn and Moyeed, 1998 and <a href="#Appendix"></a><a href="#Appendix">Appendix 1</a>) can be specified using the distributions <code>spatial.exp</code> or <code>spatial.disc</code> for the vector of random variables S = (S<sub>1</sub>, ..., S<sub>N</sub>). The syntax for these distributions is as follows: <br/><br/><code>S[1:N] ~ spatial.exp(mu[], x[], y[], tau, phi, kappa)<br/>S[1:N] ~ spatial.disc(mu[], x[], y[], tau, alpha)<br/></code><br/>where:<br/><br/><code>mu[]</code> - A vector giving the mean for each area (this can either be entered as data, assigned a prior distribution, or specified deterministically within the model code).<br/><code>x[]</code> and <code>y[]</code> - Vectors of length N giving the x and y coordinates of the location of each point, or the centroid of each area<br/><code>tau</code> - A scalar parameter representing the overall precision (inverse variance) parameter.<br/><br/>Two options are available for specifying the form of the covariance matrix: the powered exponential function and the '<code>disc</code>' function (see section on <a href="#Joint">Joint Specification</a> in Appendix 1). <br/><br/>The powered exponential function is implemented using the <code>spatial.exp</code> distribution and has 2 parameters:<br/><code>phi</code> - A scalar parameter representing the rate of decline of correlation with distance between points. Note that the magnitude of this parameter will depend on the units in which the x and y coordinates of each location are measured (e.g. metres, km etc.). <br/><code>kappa</code> - A scalar parameter controlling the amount of spatial smoothing. This is constrained to lie in the interval [0, 2). <br/><br/>The <code>disc</code> function is implemented using the <code>spatial.disc</code> distribution and has 1 parameter:<br/><code>alpha</code> - A scalar parameter representing the radius of the 'disc' centred at each (x, y) location. <strong>Note that the magnitude of this parameter will depend on the units in which the x and y coordinates of each location are measured (e.g. metres, km etc)</strong>. <br/><br/><strong>Warning</strong>: These models can be very slow for even moderate sized datasets (the algorithm is of order N<sup>3</sup>)! Experience to date also suggests that it may be better to <strong>hierarchically centre</strong> this model. For example, consider the following two alternative parameterisations of the same model:<br/><br/>Non-hierarchically centred<br/><code>      for (i in 1:N){<br/>         y[i] ~ dnorm(S[i], gamma) <br/>         mu[i] &lt;- alpha+beta*z[i]<br/>      } <br/>      S[1:N] ~ spatial.exp(mu[], x[], y[], tau, phi, 1)<br/></code><br/>Hierarchically centred <br/><code>      for (i in 1:N){<br/>         y[i] ~ dnorm(S[i], gamma) <br/>         S[i] &lt;- alpha+beta*z[i] + W[i]<br/>         mu[i]&lt;-0<br/>      }<br/>      W[1:N] ~ spatial.exp(mu[], x[], y[], tau, phi, 1)<br/></code><br/>In some simulated examples, the non-hierarchically centred parameterisation has produced incorrect results, while the hierarchically centred parameterisation gives sensible answers. This may be a feature of the single-site updating schemes used in BUGS, so interpret your results with care! (Thanks to Alan Gelfand, Shanshan Wu and Alex Schmidt for noting this problem).<br/><br/>Experience also suggests that there is often very little information in the data about the values of the parameters of the powered exponential (i.e. phi and kappa) or disc (i.e. alpha) functions. We therefore recommend that reasonably informative priors are used, or that the values are fixed a priori, based on either substantive knowledge or exploratory analysis using e.g. variograms. <br/><br/><h5 id="spatial.exp.pred">spatial.pred and spatial.unipred</h5><br/>Spatial interpolation or prediction at arbitrary locations can be carried out using the <code>spatial.pred</code> or <code>spatial.unipred</code> functions, in conjunction with fitting either the <code>spatial.exp</code> or <code>spatial.disc</code> model to a set of observed data. <code>spatial.pred</code> carries out joint or simultaneous prediction at a set of target locations, whereas <code>spatial.unipred</code> carries out single site prediction. The difference is that the single site prediction yields marginal prediction intervals (i.e. ignoring correlation between prediction locations) whereas joint prediction yields simultaneous prediction intervals for the set of target locations (which will tend to be narrower than the marginal prediction intervals). The predicted means should be the same under joint or single site prediction. The disadvantage of joint prediction is that it is very slow (the computational time is of order P<sup>3</sup>, where P is the number of prediction sites). The syntax for these predictive distributions is:<br/><br/>Joint prediction:<br/><code>         T[1:P] ~ spatial.pred(mu.T[], x.T[], y.T[], S[])</code><br/><br/>Single site prediction:<br/><code>         for(j in 1:P) {<br/>            T[j] ~ spatial.unipred(mu.T[j], x.T[j], y.T[j], S[])<br/>         }<br/></code><br/>where:<br/><br/><code>P</code> - Scalar giving the number of prediction locations<br/><code>mu.T[]</code> - vector of length <code>P</code> (or scalar for single site version) specifying the mean for each prediction location (this should be specified in the same way as the mean for the observed data S).<br/><code>x.T[]</code> and <code>y.T[]</code> - Vectors of length <code>P</code> (or scalars for single site version) giving the x and y coordinates of the location of each prediction point<br/><code>S</code> - The vector of observations to which either the <code>spatial.exp</code> or <code>spatial.disc</code> model has been fitted.<br/><br/><h5 id="CreatingANode">pois.conv</h5><br/>A conjugate Poisson-gamma spatial moving average distribution can be specified for non-negative counts defined on a spatial lattice (i.e. discrete geographical partition), using the distribution <code>pois.conv</code>. This is a discrete version of the Poisson-gamma random field model of Wolpert and Ickstadt (1998) and Best et al (2000a). The basic syntax for this distribution is as follows: <br/><br/><code>         S ~ dpois.conv(mu[])</code><br/><br/>where <code>S</code> is a non-negative scalar parameter defined at some (usually spatial) location, and <code>mu[]</code> is a vector of length J representing the influence of a set of gamma distributed latent parameters at each of J different locations on the value of S. Hence <code>mu[]</code> must be defined as a convolution of gamma random variables:<br/><br/><code>         for (j in 1 : J) { <br/>            mu[j] &lt;- gamma[j] * k[j]<br/>            gamma[j] ~ dgamma(a, b)<br/>         }<br/></code><br/>where <code>k[j]</code> is a spatial kernel or spatial 'weight' depending on some measure of distance or spatial proximity between the jth latent location and the location of S, and <code>a</code> and <code>b</code> are hyperparameters to be specified (see <a href="#Appendix2"></a><a href="#Appendix2">Appendix 2</a> for further discussion of this distribution, including suitable kernel functions). Usually, <code>k[]</code> is calculated externally and read into WinBUGS as data; alternatively, if <code>k[]</code> depends on unknown parameters, it may be defined as part of the BUGS code and re-computed at each MCMC iteration. However, this is likely to slow down the sampling within BUGS by many orders of magnitude, so is not recommended for models with large numbers of latent parameters (i.e. J large).<br/><br/>More typically, the distribution will be used for each element of a vector of counts defined on a spatial lattice of N regions, using the following syntax:<br/><br/><code>         for (i in 1:N) {<br/>            S[i] ~ dpois.conv(mu[i, ])   <br/>            for (j in 1 : J) { <br/>               mu[i, j] &lt;- gamma[j] * k[i, j]<br/>            }<br/>         }<br/></code><br/>where the latent <code>gamma[j]</code> parameters are defined as above, and <code>k[,]</code> is now an N x J matrix with elements <code>k[i,j]</code> representing the 'weight' or contribution of the latent gamma random variable at location j to the expected value of S at location i. <br/><br/>Conditional on mu, the <code>S[i]</code> have independent Poisson distributions with mean = <font>Σ</font><sub>j </sub>mu[i, j]. <br/><br/>Note that the model may be extended to include observed covariates as well as latent variables in the Poisson mean - see <a href="/examples/latest/spatial/MVCAR.html">MVCAR Example</a>.<br/><br/><h5 id="mv.car">mv.car</h5><br/><br/><strong>NOTE - This is not currently implemented in MultiBUGS</strong><br/><br/>The multivariate intrinsic Gaussian CAR prior distribution is specified using the distribution <code>mv.car</code> for the p x N matrix of random varables <code>S</code>, where columns of <code>S</code> represent the spatial units (areas) and rows represent the variables (it is important to ensure the dimensions of <code>S</code> are specified the correct way round). The syntax for this distribution is as follows:<br/><br/><code>         S[1:p, 1:N] ~ mv.car(adj[], weights[], num[], omega[ , ])</code><br/><br/>where:<br/><br/><code>adj[]</code> - A vector listing the ID numbers of the adjacent areas for each area (this is a sparse representation of the full adjacency matrix for the study region, and can be generated using the <span class="window_title">Adjacency Tool</span> from the <span class="button">Map</span> menu in GeoBUGS.<br/><code>weights[]</code> - A vector the same length as <code>adj[]</code> giving unnormalised weights associated with each pair of areas. For the CAR model described above, taking C<sub>ij</sub> = 1 (equivalently W<sub>ij</sub> = 1/ n<sub>i</sub>) if areas i and j are neighbours and 0 otherwise, gives a vector of 1's for <code>weights[]</code>.<br/><code>num[]</code> - A vector of length N (the total number of areas) giving the number of neighbours n<sub>i</sub> for each area.<br/><code>omega[,]</code> - A p x p matrix representing the precision (inverse variance) matrix of the multivariate intrinsic Gaussian CAR prior.<br/><br/>The first 3 arguments must be entered as data (it is currently not possible to allow the <code>weights</code> to be unknown); the final variable <code>omega</code> is usually treated as unknown and so is assigned a prior distribution (which must be a Wishart distribution). The data variables <code>num</code> and <code>adj</code> may be created by the adj matrix option of the <span class="window_title">Adjacency Tool</span> as described in <a href="/documentation/latest/spatial/AdjacencyMatrices.html#Adj"></a><a href="/documentation/latest/spatial/AdjacencyMatrices.html#Adj">Adjacency matrices</a>. The variable <code>weights</code> must be created by the user, and must be a vector the same length as <code>adj</code>. A common choice is to set all the <code>weights</code> equal to 1 since this gives the multivariate equivalent of the standard Besag, York and Mollie (1991) CAR model (see sections on <a href="#Intrinsic"></a><a href="#Intrinsic">intrinsic CAR models</a> and <a href="#MV"></a><a href="#MV">multivariate intrinsic CAR models</a> in Appendix 1 for further discussion of weights). The easiest way to do this is to create a loop in your BUGS model code:<br/><br/><code>         for(j in 1:sumNumNneigh) { weights[j] &lt;- 1}</code><br/><br/>where <code>sumNumNneigh</code> is the length of <code>adj</code> and is also output by the <code>adj</code> matrix option of the <span class="window_title">Adjacency Tool</span>.<br/><br/>Important things to check when using the mv.car distribution:<br/><br/>* The <code>mv.car</code> distribution uses <strong>unnormalised</strong> weights, as for the <code>car.normal</code> distribtion.<br/>* <strong>An area cannot be specified as its own neighbour</strong> so make sure the ID number of the area itself does not appear in as one of its list of neighbours in the <code>adj</code> vector. GeoBUGS does not check for this, so it is the user's responsibility. <br/>* The weights must be <strong>symmetric</strong> (W<sub>ij</sub> = W<sub>ji</sub>). GeoBUGS does carry out a check for this and returns an error message if non-symmetric weights are detected.<br/>* Take care with priors on <code>omega</code>, and be prepared to carry out sensitivity analysis to this choice.<br/>* The <code>mv.car</code> distribution is parameterised to include a <strong>sum-to-zero constraint</strong> on the random effects. This means that you must also include <strong>separate intercept</strong> terms in your model for each of the p variables, which MUST be assigned improper uniform priors using the <code>dflat() </code>distribution. <strong>Note</strong>: the mechanism for implementing the sum-to-zero constraint for mv.car in WinBUGS has been tested and appears to be robust; however, we recommend that you nevertheless include a check in your model code to ensure that the constraint has been implemented correctly (e.g. by including a line in your code to calculate the mean across areas of each variable for which the mv.car prior has been assumed). Please report any problems to n.best@imperial.ac.uk. <br/>* An alternative <strong>unconstrained</strong> version of the multivariate CAR prior is available in WinBUGS 1.4, called <code>mv.car.uncon</code>. The syntax is the same as for <code>mv.car</code>. <br/>* Because the <code>mv.car</code> (and <code>mv.car.uncon</code>) distribution is improper, it can only be used as a prior distribution, and not as a likelihood. <br/><br/><br/><br/><h5 id="Appendix">Appendix 1: Structured MV Gaussian and CAR</h5><br/>(Note: for clarity of exposition, we parameterise the Normal distribution in terms of the mean and <em>variance</em> in the following discussion. However, <em>WinBUGS</em> parameterisation of the CAR and structured MVN models is in terms of the mean and precision as usual.)<br/><br/>Assume we have a set of area-specific spatially correlated Gaussian data or random effects S<font color="#000100" face="Arial" size="2"><sub>i</sub></font>, i=1,..., N (where N is the number of areas in the study region). Suppose their joint distribution may be expressed as follows: <br/><br/><strong>S</strong> ~ MVN(<font><strong>μ</strong></font>, v<font><strong>Σ</strong></font>) <br/><br/>where <strong>S</strong> = ( S<sub>1</sub>, ....., S<sub>N </sub>), MVN denotes the N-dimensional multivariate normal distribution, <font><strong>μ</strong></font> is the 1 x N mean vector, v &gt; 0 controls the overall variability of the S<sub>i</sub> and <font><strong>Σ</strong></font> is an N x N positive definite matrix. <br/><br/><code><strong><a id="Joint">Joint specification</a></strong></code><br/>We may assume a parametric form for the elements of the between-area correlation matrix:<br/>         <font>Σ</font><font color="#000100" face="Arial" size="2"><sub>ij</sub></font>    =   f(d<font color="#000100" face="Arial" size="2"><sub>ij</sub></font>; <font>θ</font>)<br/>where d<sub>ij </sub>= distance between areas i and j. WinBUGS 1.4 allows two options for the funtion f(.) (see Richardson (1992) for further details of these functions):<br/><br/><strong>1. Powered exponential family<br/></strong><br/>         f(d<font color="#000100" face="Arial" size="2"><sub>ij</sub></font>; <font>φ, κ</font>) = exp[<font>-</font>(<font>φ </font>d<font color="#000100" face="Arial" size="2"><sub>ij</sub></font>)<font><sup>κ</sup></font><font><sup> </sup></font>] where <font>φ </font>&gt; 0, <font>κ</font> in (0, 2]<br/><br/>The parameter <font>φ</font> controls the rate of decline of correlation with distance:<br/><br/>         <font>φ</font> large <font>-</font>&gt; rapid decay<br/>         <font>φ </font>small <font>-</font>&gt; slow decay<br/><br/>One possible strategy for specifying a prior for <font>φ</font> is to choose a uniform distribution between <font>φ </font><font color="#000100" face="Arial" size="2"><sub>min</sub></font><sub> </sub>and <font>φ </font><font color="#000100" face="Arial" size="2"><sub>max</sub></font> where <font>φ </font><font color="#000100" face="Arial" size="2"><sub>min</sub></font><sub> </sub>and <font>φ </font><font color="#000100" face="Arial" size="2"><sub>max</sub></font> are chosen to give a sensible range of values for correlations both at a distance equal to the <em>maximum</em> distance between any pair of areas in the study region, and at a distance equal to the <em>minimum</em> distance between any pair of areas in the study. For example, if the minimum distance is 1 km (say), and the maximum distance is 20 km (say), then values of <font>φ </font><font color="#000100" face="Arial" size="2"><sub>min</sub></font><sub> </sub>= 0.04 and <font>φ </font><font color="#000100" face="Arial" size="2"><sub>max</sub></font> = 5 would give a diffuse but plausible prior range of correlations (assuming <font>κ</font> = 1<font>)</font> between 0.007 and 0.96 at a distance of 1 km, and between 0 and 0.45 at a distance of 20 km. <em>Note that it is advisable to choose a value of </em><font>φ </font><sub>min </sub><em>that prevents the correlation at the maximum distance between observations in the study region from being too high, since this can lead to identifiability problems between the overall mean, </em><font><strong>μ</strong></font><em>, of the spatial random variables and the correlation parameter, </em><font>φ</font><em>.</em><br/><br/>The parameter <font>κ </font>controls the amount by which spatial variations in the data are smoothed. Large values of <font>κ</font> lead to greater smoothing, with <font>κ</font> = 2 corresponding to the Gaussian correlation function (although the resulting covariance matrix is nearly singular). It is often difficult to learn much about this parameter, so unless there is a good reason for believing otherwise, it is usually advisable to set <font>κ</font> = 1 a priori. <br/><br/><strong>2. Disc model<br/></strong><br/>         f(d<font color="#000100" face="Arial" size="2"><sub>ij</sub></font>; <font>α</font>) = 2 / <font>π</font> * {cos<font><sup>-</sup></font><font color="#000100" face="Arial" size="2"><sup>1</sup></font>(d<font color="#000100" face="Arial" size="2"><sub>ij</sub></font><sub> </sub>/<font>α</font>)<font><sup> </sup></font><font>-</font><font><sup> </sup></font>[(d<font color="#000100" face="Arial" size="2"><sub>ij</sub></font><sub> </sub>/<font>α</font>)(1 <font>-</font><font><sup> </sup></font>(d<font color="#000100" face="Arial" size="2"><sub>ij</sub></font><font color="#000100" face="Arial" size="2"><sup>2</sup></font><sub> </sub>/<font>α</font><font color="#000100" face="Arial" size="2"><sup>2</sup></font>))]<font color="#000100" face="Arial" size="2"><sup>1/2</sup></font> }   for d<font color="#000100" face="Arial" size="2"><sub>ij</sub></font><sub> </sub><font>&lt; α</font><br/>                  = 0   for d<font color="#000100" face="Arial" size="2"><sub>ij</sub></font><sub> </sub><font>&gt; α</font><br/><br/>The parameter <font>α</font> controls the rate of decline of correlation with distance:<br/><br/>   <font>α</font> large <font>-</font>&gt; slow decay<br/>   <font>α </font>small <font>-</font>&gt; rapid decay<br/><br/>The disc function leads to an approximately linear decrease in correlation with increasing distance, with correlation declining to zero at a distance equal to <font>α</font>. <em>Again, it is advisable to choose a prior for </em><font>α</font><sub> </sub><em>that prevents the correlation at the maximum distance between observations in the study region from being too high, since this can lead to identifiability problems between the overall mean, </em><font><strong>μ</strong></font><em>, of the spatial random variables and the correlation parameter,</em> <font>α</font><em>. An upper prior bound on </em><font>α</font><em> equal to a small multiple of the maximum distance in the study region is therefore a sensible 'default' choice. The minimum value allowed a priori for </em><font>α</font><em> should also be chosen carefully since values of </em><font>α</font><em> less than the minimum distance between observations in the study region will not be identifiable.<br/></em><br/>Exploratory analysis using variograms maybe be helpful to help chose an appropriate specification for the correlation function and associated parameters. <br/><br/><code><strong><a id="Conditional">Conditional specification</a></strong></code><br/>By writing the between-area covariance matrix in the following form:<br/>         v<font><strong>Σ</strong></font> = v(<strong>I</strong> - <font>γ </font><strong>C</strong>)<font color="#000100" face="Arial" size="2"><sup>-1</sup></font> <strong>M<br/><br/></strong>where <strong>I </strong>= N x N identity matrix<br/><strong>M </strong>= N x N diagonal matrix, with elements M<font color="#000100" face="Arial" size="2"><sub>ii</sub></font> proportional to the conditional variance of S<font color="#000100" face="Arial" size="2"><sub>i</sub></font> | S<font color="#000100" face="Arial" size="2"><sub>j</sub></font> <br/><strong>C </strong>= N x N weight matrix, with elements C<sub>ij</sub> reflecting spatial association between areas i and j<br/><font>γ </font>= controls overall strength of spatial dependence<br/><br/>and using standard multivariate normal theory (e.g. Johnson and Kotz, 1972; Besag and Kooperberg, 1995), the joint multivariate Gaussian model can be expressed in the form of a set of conditional distributions<br/><br/>S<font color="#000100" face="Arial" size="2"><sub>i</sub></font> | <strong>S</strong><font><sub>-</sub></font><font color="#000100" face="Arial" size="2"><sub>i</sub></font> ~ Normal (<font>μ </font><font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>+ <font>Σ</font><font color="#000100" face="Arial" size="2"><sub>j</sub></font> <font>γ </font>C<font color="#000100" face="Arial" size="2"><sub>ij</sub></font> (s<font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub><font>-μ</font><font color="#000100" face="Arial" size="2"><sub>i</sub></font>), <font>φ</font> M<font color="#000100" face="Arial" size="2"><sub>ii</sub></font> ), <br/><br/>(here <font>Σ</font><font color="#000100" face="Arial" size="2"><sub>j</sub></font> denotes summation over j = 1 to N, not covariance matrix, and <strong>S</strong><font><sub>-</sub></font><font color="#000100" face="Arial" size="2"><sub>i</sub></font> denotes all the elements of <strong>S</strong> except S<font color="#000100" face="Arial" size="2"><sub>i</sub></font>)<br/><br/>From a modelling perspective, use of the joint formulation requires specification of the elements of the covariance matrix <font><strong>Σ</strong></font> (see above), while use of the conditional formulation reduces to specification of the matrices <strong>C</strong> and <strong>M</strong> and the spatial dependence parameter <font>γ</font>. Various constraints are needed on the values of <strong>C</strong>, <strong>M</strong> and <font>γ</font> in order to ensure that <font><strong>Σ</strong></font> is symmetric positive definite:<br/><br/>* <font><strong>Σ</strong></font> is only symmetric if C<font color="#000100" face="Arial" size="2"><sub>ij</sub></font> M<font color="#000100" face="Arial" size="2"><sub>jj</sub></font> = C<font color="#000100" face="Arial" size="2"><sub>ji</sub></font> M<font color="#000100" face="Arial" size="2"><sub>ii</sub></font><sub><br/></sub>* Var( S<font color="#000100" face="Arial" size="2"><sub>i</sub></font> | S<font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub>) = vM<font color="#000100" face="Arial" size="2"><sub>ii</sub></font> &gt; 0 so M<font color="#000100" face="Arial" size="2"><sub>ii</sub></font> must be &gt; 0* To ensure S is positive definite, <font>γ</font> must lie between <font>γ </font><sub>min </sub>and <font>γ </font><sub>max </sub>where <font>γ </font><sub>min</sub><font color="#000100" face="Arial" size="2"><sup>-1</sup></font> and <font>γ </font><sub>max</sub><font color="#000100" face="Arial" size="2"><sup>-1</sup></font><sub> </sub>are the smallest and largest eigenvalues of <strong>M</strong><font color="#000100" face="Arial" size="2"><sup>-1/2</sup></font> <strong>C</strong> <strong>M</strong><font color="#000100" face="Arial" size="2"><sup>1/2</sup></font>   * In practice, we often expect positive spatial dependence, so constrain prior for <font>γ</font> to be between 0 and <font>γ </font><sub>max</sub><br/>* <font>γ</font> = 0 implies no spatial dependence<sub><br/><br/></sub><code><strong><a id="Intrinsic">Intrinsic CAR model</a></strong></code><br/>Besag, York and Mollie (1991) propose an intrinsic version of this CAR model in which the covariance matrix <font><strong>Σ</strong></font> is not positive definite. Their model corresponds to choosing C<font color="#000100" face="Arial" size="2"><sub>ij</sub></font> = 1/n<font color="#000100" face="Arial" size="2"><sub>i</sub></font> if areas i and j are adjacent and C<font color="#000100" face="Arial" size="2"><sub>ij</sub></font> = 0 otherwise (with C<font color="#000100" face="Arial" size="2"><sub>ii</sub></font> also set to 0), M<font color="#000100" face="Arial" size="2"><sub>ii</sub></font> = 1/n<font color="#000100" face="Arial" size="2"><sub>i</sub></font>, and setting <font>γ</font> = <font>γ </font><font color="#000100" face="Arial" size="2"><sub>max</sub></font><sub> </sub>which turns out to always be 1 with this particular choice of C<font color="#000100" face="Arial" size="2"><sub>ij</sub></font> and M<font color="#000100" face="Arial" size="2"><sub>ii</sub></font>. Here, n<font color="#000100" face="Arial" size="2"><sub>i</sub></font> is the number of areas which are adjacent to area i. Comparison with the equations above shows that this leads to the following model for the conditional distribution of S<font color="#000100" face="Arial" size="2"><sub>i</sub></font> | <strong>S</strong><font><sub>-</sub></font><font color="#000100" face="Arial" size="2"><sub>i</sub></font> :<br/><br/>S<font color="#000100" face="Arial" size="2"><sub>i</sub></font> | <strong>S</strong><font><sub>-</sub></font><font color="#000100" face="Arial" size="2"><sub>i</sub></font> ~ Normal ( S.bar<font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>, v / n<font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>)<br/><br/>where S.bar<font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>= <font>Σ</font><font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> in </sub><font><sub>δ</sub></font><font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>S<font color="#000100" face="Arial" size="2"><sub>j</sub></font> / n<font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>and <font>δ</font><font color="#000100" face="Arial" size="2"><sub>i</sub></font> denotes the set of labels of the "neighbours" of area i. Hence S<font color="#000100" face="Arial" size="2"><sub>i</sub></font> has a normal distribution with conditional mean given by the average of the neighbouring S<font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub>'s and conditional variance inversely proportional to the number of neighbours n<font color="#000100" face="Arial" size="2"><sub>i</sub></font> . Note that an equivalent specification is take <em>unnormalised </em>weights W<font color="#000100" face="Arial" size="2"><sub>ij</sub></font> = 1 if areas i and j are adjacent and W<font color="#000100" face="Arial" size="2"><sub>ij</sub></font> = 0 otherwise, and set C<font color="#000100" face="Arial" size="2"><sub>ij</sub></font> = W<font color="#000100" face="Arial" size="2"><sub>ij</sub></font> / W<font color="#000100" face="Arial" size="2"><sub>i+</sub></font> where W<font color="#000100" face="Arial" size="2"><sub>i+</sub></font> = <font>Σ</font><font color="#000100" face="Arial" size="2"><sub>j</sub></font> W<font color="#000100" face="Arial" size="2"><sub>ij</sub></font>. The <strong><em>car.normal</em></strong> and (<strong><em>car.l1</em></strong>) distributions in <em>GeoBUGS</em> requires the user to specify <em>unnormalised weights</em>.<br/><br/>Since the CAR model defined above is improper (the overall mean of the S<sub>i </sub>is not defined), it can only be used as a prior distribution for spatially distributed random effects, and not as a likelihood for data. It is often convenient to assume that suchrandom effects have zero mean. Besag and Kooperberg (1995) show that constraining the random effects to sum to zero and specifying a separate intercept term with a location invariant Uniform(-infty, +infty) prior is equivalent to the unconstrained parameterisation with no separate intercept. WinBUGS 1.4 includes a distribution called <strong><em>dflat()</em></strong> which corresponds to an improper (flat) prior on the whole real line. This prior must always be used for the intercept term in a model including CAR random effects.<br/><br/>We must also specify prior distributions for the overall variance parameter v. As usual in WinBUGS, the <strong><em>car.normal</em></strong> (and <strong><em>car.l1</em></strong>) distributions are parameterised in terms of the precision <font>τ </font>= 1/v<font> . </font>Care is needed when choosing a prior for<font> τ</font> since the posterior variance of the random effects can be quite sensitive. One option is a gamma distribution with shape and inverse scale parameters both equal to 0.01. This has a mean of 0.01/0.01 = 1 and a large variance of 0.01/(0.01)<sup>2</sup> = 100; however, this tends to place most of the prior mass away from zero (on the scale of the random effects standard deviation), and so in situations when the true spatial dependence between areas is negligible (i.e. standard deviation close to zero) this may induce artefactual spatial structure in the posterior. Kelsall and Wakefield (1999) suggest an alternative gamma(0.5, 0.0005) prior for the precision parameter of the spatial random effects in a CAR model. This expresses the prior belief that the random effects standard deviation is centered around 0.05 with a 1% prior probability of being smaller than 0.01 or larger than 2.5. <br/><sub><br/></sub><code><strong><a id="Proper">Proper CAR model</a></strong></code><br/>If <font>γ</font> is constrained to lie in the interval (<font>γ </font><font color="#000100" face="Arial" size="2"><sub>min</sub></font><sub> </sub>, <font>γ </font><font color="#000100" face="Arial" size="2"><sub>max</sub></font><sub> </sub>) where <font>γ </font><font color="#000100" face="Arial" size="2"><sub>min</sub></font><font color="#000100" face="Arial" size="2"><sup>-1</sup></font> and <font>γ </font><font color="#000100" face="Arial" size="2"><sub>max</sub></font><font color="#000100" face="Arial" size="2"><sup>-1</sup></font><sub> </sub>are the smallest and largest eigenvalues of <strong>M</strong><font color="#000100" face="Arial" size="2"><sup>-1/2</sup></font> <strong>C</strong> <strong>M</strong><font color="#000100" face="Arial" size="2"><sup>1/2</sup></font> as defined above, rather than being fixed to its maximum as in the intrinsic CAR, then the resulting distribution is proper provided the constraints on <strong>C</strong> and <strong>M</strong> are still satisfied. The choice C<font color="#000100" face="Arial" size="2"><sub>ij</sub></font> = 1/n<font color="#000100" face="Arial" size="2"><sub>i</sub></font> if areas i and j are adjacent and C<font color="#000100" face="Arial" size="2"><sub>ij</sub></font> = 0 otherwise (with C<font color="#000100" face="Arial" size="2"><sub>ii</sub></font> also set to 0) and M<font color="#000100" face="Arial" size="2"><sub>ii</sub></font> = 1/n<font color="#000100" face="Arial" size="2"><sub>i</sub></font>, where n<font color="#000100" face="Arial" size="2"><sub>i</sub></font> is the number of areas which are adjacent to area i is still valid for the proper CAR. In the context of disease mapping Cressie and Chan (1989) and Stern and Cressie (1999) choose an alternative parameterisation:<br/><br/>   M<font color="#000100" face="Arial" size="2"><sub>ii</sub></font> = 1/E<font color="#000100" face="Arial" size="2"><sub>i</sub></font> (the inverse of the expected count or population size in area i)<br/>   C<font color="#000100" face="Arial" size="2"><sub>ij</sub></font> = (E<font color="#000100" face="Arial" size="2"><sub>j</sub></font> / E<font color="#000100" face="Arial" size="2"><sub>i</sub></font>)<font color="#000100" face="Arial" size="2"><sup>1/2</sup></font><sup> </sup>for neighbouring areas i, j and 0 otherwise<br/><sub><br/></sub><code><strong><a id="MV">Multivariate instrinsic CAR model</a></strong></code><br/>Assume we have a multivariate p-dimensional vector of spatially correlated Gaussian data or random effects in each area, <strong>S</strong><font color="#000100" face="Arial" size="2"><sub>i</sub></font> = (S<font color="#000100" face="Arial" size="2"><sub>1i</sub></font> , S<font color="#000100" face="Arial" size="2"><sub>2i</sub></font>,....., S<font color="#000100" face="Arial" size="2"><sub>pi</sub></font> )', i=1,..., N. The CAR models discussed above extend naturally to a multivariate setting by replacing the univariate Gaussian conditional distribution for S<font color="#000100" face="Arial" size="2"><sub>i</sub></font> | S<font color="#000100" face="Arial" size="2"><sub>j</sub></font>with a multivariate conditional distribution. In the case of the intrinsic CAR prior with 0-1 adjacency weights as used by Besag, York and Mollie (1991), and taking the case of p = 2 for simplicity, this gives:<br/><strong>S</strong><font color="#000100" face="Arial" size="2"><sub>i</sub></font> | (<strong>S</strong><font color="#000100" face="Arial" size="2"><sub>1(</sub></font><font><sub>-</sub></font><font color="#000100" face="Arial" size="2"><sub>i)</sub></font>, <strong>S</strong><font color="#000100" face="Arial" size="2"><sub>2(</sub></font><font><sub>-</sub></font><font color="#000100" face="Arial" size="2"><sub>i)</sub></font>) ~ Bivariate Normal (<strong>S.bar</strong><font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>, <strong>V</strong> / n<font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>), <br/>(here (<strong>S</strong><font color="#000100" face="Arial" size="2"><sub>1(</sub></font><font><sub>-</sub></font><font color="#000100" face="Arial" size="2"><sub>i)</sub></font>, <strong>S</strong><font color="#000100" face="Arial" size="2"><sub>2(</sub></font><font><sub>-</sub></font><font color="#000100" face="Arial" size="2"><sub>i)</sub></font>) denotes the elements of the 2 x N matrix S excluding the ith area (column))<br/><br/>where <strong>S.bar</strong><font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>= <font>(</font>S.bar<font color="#000100" face="Arial" size="2"><sub>i1</sub></font><sub> </sub>,S.bar<font color="#000100" face="Arial" size="2"><sub>i2</sub></font>) with S.bar<font color="#000100" face="Arial" size="2"><sub>ip</sub></font><sub> </sub>= <font>Σ </font><font color="#000100" face="Arial" size="2"><sub>j in </sub></font><font><sub>δ</sub></font><font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>S<font color="#000100" face="Arial" size="2"><sub>jp</sub></font> / n<font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>and, as in the univariate case, <font>δ</font><font color="#000100" face="Arial" size="2"><sub>i</sub></font> and n<font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>denote the set of labels of the "neighbours" of area i and the number of neighbours, respectively. <strong>V</strong> is a 2 x 2 covariance matix with diagonal elements v<font color="#000100" face="Arial" size="2"><sub>11</sub></font> and v<font color="#000100" face="Arial" size="2"><sub>22</sub></font> representing the conditional variances of S<font color="#000100" face="Arial" size="2"><sub>1</sub></font> and S<font color="#000100" face="Arial" size="2"><sub>2</sub></font><sub> </sub>respectively, and off-diagonal element v<font color="#000100" face="Arial" size="2"><sub>12</sub></font> representing the (conditional) within-area covariance between S<font color="#000100" face="Arial" size="2"><sub>1</sub></font> and S<font color="#000100" face="Arial" size="2"><sub>2</sub></font>. In general <strong>S</strong><font color="#000100" face="Arial" size="2"><sub>i</sub></font> has a p-dimensional multivariate normal distribution with pth element of the conditional mean vector given by the average of the neighbouring S<font color="#000100" face="Arial" size="2"><sub>jp</sub></font><sub> </sub>'s and conditional covariance matrix inversely proportional to the number of neighbours n<font color="#000100" face="Arial" size="2"><sub>i</sub></font>, with pth diagonal element representing the conditional variance of the pth component of <strong>S</strong> and off-diagonal elements representing the conditional covariances between each pair of the p elements of <strong>S</strong>. <br/><br/>Gelfand and Vounatsou (2003) discuss a multivariate generalisation of the proper version of CAR distribution, but only the improper intrinsic multivariate CAR is currently implemented in WinBUGS. <br/><br/><br/><h5 id="Appendix2">Appendix 2: Poisson-gamma spatial moving-average convolution</h5><br/><br/>Spatial moving average models are a flexible class of models that have been used to describe continuous spatial processes, particularly in geostatistical applications. Such models are constructed by integrating a simple two-dimensional random noise process (for example, a grid of iid Gaussian random variables) with a smoothing kernel that is a function of distance and, possibly, location. The kernel can be thought of as a device to `smear out' the random noise process in two-dimensional space to give a smooth surface.<br/><br/>Spatial moving average models have been developed primarily for continuous spatial processes and are currently not implementable in WinBUGS 1.4. However, Ickstadt and Wolpert (1998) and Best et al (2000b) proposed a discrete version of a gamma moving average process, for use in identity-link Poisson regression models. Suppose we have a set of area-specific spatially correlated Poisson count data (or random effects) S<font color="#000100" face="Arial" size="2"><sub>i</sub></font>, i=1,..., N (where N is the number of areas in the study region). Ickstadt and Wolpert (1998) and Best et al (2000b) model spatial dependence at the level of the Poisson mean, and assume that the counts S<font color="#000100" face="Arial" size="2"><sub>i</sub></font> are conditionally independent given this mean:<br/><br/>         S<font color="#000100" face="Arial" size="2"><sub>i</sub></font> ~ Poisson( <font>λ</font><font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>) <br/><br/>The model for each <font>λ</font><font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>is constructed by specifying an arbitrary grid of latent iid gamma random variables <font>γ</font><font color="#000100" face="Arial" size="2"><sub>j</sub></font> (j=1,...,J where J is the total number of grid cells defining the latent process) covering the study region. These are then convolved with a kernel matrix whose elements, k<font color="#000100" face="Arial" size="2"><sub>ij</sub></font>, represent the relative contribution of the latent variable in grid cell j to the Poisson mean in area i:<br/><br/>         <font>λ</font><font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>= <font>Σ</font><font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub><font>γ</font><font><sub> </sub></font><font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub>* k<font color="#000100" face="Arial" size="2"><sub>ij</sub></font><sub> </sub><br/><br/>Best et al (2000b) assume an isotropic, stationary Gaussian kernel function (although other kernel forms are easily accommodated, such as an adjacency-based kernel - see the <a href="/examples/latest/spatial/Forest.html">'Forest Example'</a>):<br/><br/>         k<font color="#000100" face="Arial" size="2"><sub>ij</sub></font><sub> </sub>= <font>τ</font> / (2<font>π ρ</font><font color="#000100" face="Arial" size="2"><sup>2</sup></font>) exp(<font>-</font>d<font color="#000100" face="Arial" size="2"><sub>ij</sub></font><font color="#000100" face="Arial" size="2"><sup>2</sup></font> / 2<font>ρ</font><font color="#000100" face="Arial" size="2"><sup>2</sup></font>)<br/><br/>where <font>τ</font> can be thought of as a scale factor for the <font>λ</font>'s, d<font color="#000100" face="Arial" size="2"><sub>ij</sub></font> is the distance between the centroid of area i and the centroid of latent grid cell j, and <font>ρ</font> is the spatial range parameter governing how rapidly the influence of the latent gamma random variables on the area-specific Poisson means declines with distance. <br/><br/>One interpretation of Poisson-gamma moving average model is to view the gamma random variables as representing the location and magnitude of unmeasured risk factors, and the area-specific Poisson means <font>λ</font><font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>as representing the cumulative effect of these risk factors in each area, weighted by their distance from the area according to the kernel 'weights' k<font color="#000100" face="Arial" size="2"><sub>ij</sub></font>. <br/><br/>The model may be extended to include observed covariates and an offset adjustment (e.g. to account for different populations in different areas). Observed covariates are included as additive terms in the linear predictor <font>λ</font><font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>as in a standard identity link Poisson regression:<br/><br/>         <font>λ</font><font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>= <font>Σ </font><font color="#000100" face="Arial" size="2"><sub>k</sub></font><sub> </sub><font>β </font><font color="#000100" face="Arial" size="2"><sub>k</sub></font><sub> </sub>X<font color="#000100" face="Arial" size="2"><sub>ik</sub></font><sub> </sub>+ <font>Σ</font><font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub><font>γ</font><font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub>* k<font color="#000100" face="Arial" size="2"><sub>ij</sub></font><sub> </sub><br/><br/>where X<font color="#000100" face="Arial" size="2"><sub>ik</sub></font><sub> </sub>is the value of the kth observed covariate in area i. Note that due to the identity link, all covariates and regression coefficients must take positive values, yielding an interpretation as additive excess risk factors. The latent terms <font>θ</font><font color="#000100" face="Arial" size="2"><sub>i</sub></font> = <font>Σ</font><font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub><font>γ</font><font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub>* k<font color="#000100" face="Arial" size="2"><sub>ij</sub></font><sub> </sub>may then be thought of as a spatial (non-negative) random effect for area i. Adjustment for an offset - say the population living in each area, N<font color="#000100" face="Arial" size="2"><sub>i</sub></font> - is easily achieved by setting <font><br/><br/>         λ </font><font color="#000100" face="Arial" size="2"><sub>i</sub></font><sub> </sub>= p<font color="#000100" face="Arial" size="2"><sub>i</sub></font> N<font color="#000100" face="Arial" size="2"><sub>i</sub></font> <br/>         p<font color="#000100" face="Arial" size="2"><sub>i</sub></font> = <font>Σ </font><font color="#000100" face="Arial" size="2"><sub>k</sub></font><sub> </sub><font>β </font><font color="#000100" face="Arial" size="2"><sub>k</sub></font><sub> </sub>X<font color="#000100" face="Arial" size="2"><sub>ik</sub></font><sub> </sub>+ <font>Σ</font><font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub><font>γ </font><font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub>* k<font color="#000100" face="Arial" size="2"><sub>ij</sub></font><sub> </sub><br/><br/>Note that Best et al (2004) discuss how to standardise the offset N<font color="#000100" face="Arial" size="2"><sub>i</sub></font> for different age and sex distributions within each area in an epidemiological application of these models. <br/><br/>Estimation of the <code>pois.conv</code> distribution is carried out in WinBUGS 1.4 using a data augmentation scheme to exploit the Poisson-gamma conjugacy of the full conditionals for the <font>γ </font><font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub>parameters (see Ickstadt and Wolpert (1998) and Best et al (2000b) for details). It is also a good idea to assume gamma prior distributions for any other uncertain parameters in the linear predictor <font>λ</font><font color="#000100" face="Arial" size="2"><sub>i</sub></font> (e.g. the <font>β </font><font color="#000100" face="Arial" size="2"><sub>k</sub></font><sub> </sub>parameters above) to exploit this conjugacy, although it is possible to assume any suitable prior distribution with positive support for these other parameters. Hyperprior specification is discussed in detail by Ickstadt and Wolpert (1998) and Best et al (2000b). Note however that the prior shape (a) and precision (b) parameters of the latent gamma variables should be chosen such that <font>γ</font><font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub>has prior mean proportional to the area of the j<font color="#000100" face="Arial" size="2"><sup>th</sup></font> latent grid cell. This makes the model spatially extensible in the sense that any partition of the latent gamma random variables will lead to identical probability distributions for the kernel-weighted sums <font>Σ </font><font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub><font>γ</font><font color="#000100" face="Arial" size="2"><sub>j</sub></font><sub> </sub>* k<font color="#000100" face="Arial" size="2"><sub>ij</sub></font>.<br/><br/>

</p>


</div><div class="d-none d-lg-block col-lg-3 col-xl-3" id="onthispage"><div class="sticky-top stickymenu"><h5>On this page</h5><ul><li><a href="#car.normal">car.normal and car.l1</a></li><li><a href="#car.proper">car.proper</a></li><li><a href="#spatial.exp">spatial.exp and spatial.disc</a></li><li><a href="#spatial.pred">spatial.pred and spatial.unipred</a></li><li><a href="#pois.conv">pois.conv</a></li><li><a href="#mv.car">mv.car</a></li><li><a href="#Appendix">Appendix 1: Structured MV Gaussian and CAR</a></li><li><a href="#Appendix2">Appendix 2: Poisson-Gamma Spatial moving-average convolution</a></li></ul></div></div></div></div></body></html>