<!DOCTYPE html PUBLIC "-//W3C//DTD Html 1.0 Strict//EN" "http://www.w3.org/TR/Html1/DTD/strict.dtd">
<html><head>
<title>ChangePoints</title>

<link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" rel="stylesheet"/>
<script crossorigin="anonymous" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<link href="/css/bootstrap.css" rel="stylesheet"/>
<link href="images/favicon.ico" rel="icon" type="image/x-icon"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
</head>
<body>
<nav class="navbar navbar-expand sticky-top navbar-light bg-light">
<a class="navbar-brand" href="/"><img src="/images/logo.svg"/>MultiBUGS</a>
<div class="collapse navbar" id="navbarSupportedContent">
<ul class="navbar-nav mr-auto">
<li class="nav-item">
<a class="nav-link" href="/">Home</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/about">About</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/download">Download</a>
</li>
<li class="nav-item">
<a class="nav-link" href="/documentation/latest/">Documentation</a>
</li>
<li class="nav-item active">
<a class="nav-link" href="/examples/latest/">Examples <span class="sr-only">(current)</span></a>
</li>
</ul>
</div>
</nav><div class="container-fluid"><div class="row main"><div class="col-md-3 col-lg-2 col-xl-3"><div class="sticky-top stickymenu" id="contents">
<button aria-controls="navbarContents" aria-expanded="false" aria-label="Toggle docs navigation" class="btn btn-link d-md-none ml-3 mr-3 mt-3 collapsed mb-toggler" data-target="#navbarContents" data-toggle="collapse" type="button">
<span class="mb-toggler-icon mr-1"></span>
    Contents
  </button>

<h5 class="d-none d-md-block">Examples</h5>
<div class="collapse mb-links" id="navbarContents">
<ul class="list-unstyled">
<li class="nav-item"><a aria-expanded="true" class="dropdown-toggle nav-link" data-toggle="collapse" href="#volume1">Volume I</a>
<ul class="collapse" id="volume1">
<li><a href="/examples/latest/Volumei.html">Contents</a></li>
<li><a href="/examples/latest/Rats.html" title="Normal hierarchical model">Rats</a></li>
<li><a href="/examples/latest/Pumps.html" title="Conjugate gamma-Poisson hierarchical model">Pumps</a></li>
<li><a href="/examples/latest/Dogs.html" title="Log linear binary model">Dogs</a></li>
<li><a href="/examples/latest/Seeds.html" title="Random effects logistic regression">Seeds</a></li>
<li><a href="/examples/latest/Surgical.html" title="Institutional ranking">Surgical</a></li>
<li><a href="/examples/latest/Magnesium.html" title="Meta-analysis prior sensitivity">Magnesium</a></li>
<li><a href="/examples/latest/Salm.html" title="Extra-Poisson variation in dose-response study">Salm</a></li>
<li><a href="/examples/latest/Equiv.html" title="Bioequivalence in a cross-over trial">Equiv</a></li>
<li><a href="/examples/latest/Dyes.html" title="Variance components model">Dyes</a></li>
<li><a href="/examples/latest/Stacks.html" title="Robust and ridge regression">Stacks</a></li>
<li><a href="/examples/latest/Epil.html" title="Repeated measures on Poisson counts">Epil</a></li>
<li><a href="/examples/latest/Blockers.html" title="Random effects meta-analysis of clinical trials">Blockers</a></li>
<li><a href="/examples/latest/Oxford.html" title="Smooth fit to log-odds ratios in case control studies">Oxford</a></li>
<li><a href="/examples/latest/Lsat.html" title="Latent variable models for item-response data">LSAT</a></li>
<li><a href="/examples/latest/Bones.html" title="Latent trait model for multiple ordered categorical responses">Bones</a></li>
<li><a href="/examples/latest/Inhalers.html" title="Random effects model for ordinal responses from a cross-over trial">Inhalers</a></li>
<li><a href="/examples/latest/Mice.html" title="Weibull regression in censored survival analysis">Mice</a></li>
<li><a href="/examples/latest/Kidney.html" title="Weibull regression with random effects">Kidney</a></li>
<li><a href="/examples/latest/Leuk.html" title="Survival analysis using Cox regression">Leuk</a></li>
<li><a href="/examples/latest/Leukfr.html" title="Cox regression with frailties">LeukFr</a></li>
</ul>
<li class="nav-item"><a aria-expanded="true" class="dropdown-toggle nav-link" data-toggle="collapse" href="#volume2">Volume II</a>
<ul class="collapse" id="volume2">
<li><a href="/examples/latest/Volumeii.html">Contents</a></li>
<li><a href="/examples/latest/Dugongs.html" title="A nonconjugate, nonlinear model">Dugongs</a></li>
<li><a href="/examples/latest/Otrees.html" title="A hierarchical, nonlinear model">Orange trees</a></li>
<li><a href="/examples/latest/OtreesMVN.html" title="A hierarchical, nonlinear model">MV Orange trees</a></li>
<li><a href="/examples/latest/Biopsies.html" title="Latent class model">Biopsies</a></li>
<li><a href="/examples/latest/Eyes.html" title="Normal mixture model">Eyes</a></li>
<li><a href="/examples/latest/Hearts.html" title="A mixture model for count data">Hearts</a></li>
<li><a href="/examples/latest/Air.html" title="Covariate measurement error">Air</a></li>
<li><a href="/examples/latest/Cervix.html" title="Case-control study with errors in covariates">Cervix</a></li>
<li><a href="/examples/latest/Jaws.html" title="Repeated measures analysis of variance">Jaw</a></li>
<li><a href="/examples/latest/BiRats.html" title="A bivariate Normal hierarchical model">Birats</a></li>
<li><a href="/examples/latest/Schools.html" title="Multivariate hierarchical model of examination results">Schools</a></li>
<li><a href="/examples/latest/Ice.html" title="Non-parametric smoothing in an age-cohort model">Ice</a></li>
<li><a href="/examples/latest/Beetles.html" title="Logistic, probit and extreme value models">Beetles</a></li>
<li><a href="/examples/latest/Alligators.html" title="Multinomial logistic model">Alligators</a></li>
<li><a href="/examples/latest/Endo.html" title="Conditional inference in case-control studies">Endo</a></li>
<li><a href="/examples/latest/Stagnant.html" title="A change point problem">Stagnant</a></li>
<li><a href="/examples/latest/Asia.html" title="An expert system">Asia</a></li>
<li><a href="/examples/latest/Pigs.html" title="Genetic counseling and pedigree analysis">Pigs</a></li>
<li><a href="/examples/latest/t-df.html" title="Degree of freedom of a t distribution">Simulating data</a></li>
</ul>
<li class="nav-item"><a aria-expanded="true" class="dropdown-toggle nav-link" data-toggle="collapse" href="#volume3">Volume III</a>
<ul class="collapse" id="volume3">
<li><a href="/examples/latest/Volumeiii.html">Contents</a></li>
<li><a href="/examples/latest/Camel.html" title="Multivariate normal with structured missing data">Camel</a></li>
<li><a href="/examples/latest/Eyetracking.html" title="Dirichlet process prior">Eye Tracking</a></li>
<li><a href="/examples/latest/Fire.html" title="Data distribution using dloglik">Fire insurance claims</a></li>
<li><a href="/examples/latest/Funshapes.html" title="General constraints">Fun Shapes</a></li>
<li><a href="/examples/latest/Hepatitis.html" title="Random effects model with measurement error">Hepatitis</a></li>
<li><a href="/examples/latest/Hips1.html" title="Deterministic cost-effectiveness model">Hips1</a></li>
<li><a href="/examples/latest/Hips2.html" title="Stochastic cost-effectiveness model">Hips2</a></li>
<li><a href="/examples/latest/Hips3.html" title="Cost-effectiveness model">Hips3</a></li>
<li><a href="/examples/latest/Hips4.html" title="Cost-effectiveness model">Hips4</a></li>
<li><a href="/examples/latest/Jama.html" title="Radio carbon dating with phase information">Jama</a></li>
<li><a href="/examples/latest/Pigweights.html" title="Smoothed histogram">Pig Weights</a></li>
<li><a href="/examples/latest/Pines.html" title="Bayes factors using pseudo priors">Pines</a></li>
<li><a href="/examples/latest/StVeit.html" title="Radio carbon dating with stratification">St Veit</a></li>
</ul>
<li class="nav-item"><a aria-expanded="true" class="dropdown-toggle nav-link" data-toggle="collapse" href="#volume4">Volume IV</a>
<ul class="collapse show" id="volume4">
<li><a href="/examples/latest/Volumeiv.html">Contents</a></li>
<li><a href="/examples/latest/SeedsDataCloning.html" title="Estimating MLEs">Seeds</a></li>
<li><a href="/examples/latest/Coins.html" title="The ABC">Coins</a></li>
<li><a href="/examples/latest/SmartPhones.html" title="A bootstrap approach">Smart phones</a></li>
<li><a href="/examples/latest/Abbey.html" title="Share prices a stable approach">Abbey</a></li>
<!--<li><a href="/examples/latest/BeetlesMLE.html" title="Differential evolution and MLEs">Beetles</a></li>-->
<li><a href="/examples/latest/BeetlesProbit.html" title="Probit regression and censoring">Beetles</a></li>
<li><a href="/examples/latest/Preeclampsia.html" title="A multistage approach">Preeclampsia</a></li>
<li><a href="/examples/latest/Lotka-Volterra.html" title="A simple ODE model">Lotka-Volterra</a></li>
<li><a href="/examples/latest/FiveCompartment.html" title="A complex ODE model">Five compartment</a></li>
<li>Change points</li>
<li><a href="/examples/latest/Pollution.html" title="An autoregressive time series model">Pollution</a></li>
<li><a href="/examples/latest/Methadone.html" title="A large e-health random effects model">Methadone</a></li>
<li><a href="/examples/latest/Functionals.html" title="Integration and algebraic equations">Functionals</a></li>
</ul>
<li class="nav-item"><a aria-expanded="true" class="dropdown-toggle nav-link" data-toggle="collapse" href="#ecology">Ecology</a>
<ul class="collapse" id="ecology">
<li><a href="/examples/latest/VolumeEco.html">Contents</a></li>
<li><a href="/examples/latest/Gentians.html" title="Imperfect detection in site occppancy">Gentians</a></li>
<li><a href="/examples/latest/Sparrowhawk.html" title="Generalised metapopulation model">Sparrowhawks</a></li>
<li><a href="/examples/latest/Birds.html" title="Estimating species richness">Birds</a></li>
<li><a href="/examples/latest/Lizards.html" title="Mixture model for abundance with imperfect detection">Lizards</a></li>
<li><a href="/examples/latest/Voles.html" title="Estimating size of closed population">Voles</a></li>
<li><a href="/examples/latest/Impala.html" title="Distance sampling">Impala</a></li>
</ul>
</li>
<li class="nav-item"><a aria-expanded="true" class="dropdown-toggle nav-link" data-toggle="collapse" href="#geobugs">GeoBUGS</a>
<ul class="collapse" id="geobugs">
<li><a href="/examples/latest/spatial/Examples.html">Contents</a></li>
<li><a href="/examples/latest/spatial/Scotland.html" title="Lip cancer in Scotland">Conditional Autoregressive (CAR) models for disease mapping</a></li>
<li><a href="/examples/latest/spatial/LHA.html" title="Lung cancer in a London Health Authority">Convolution priors</a></li>
<li><a href="/examples/latest/spatial/Scotland1.html" title="Lip cancer revisited">Proper CAR model</a></li>
<li><a href="/examples/latest/spatial/Elevation.html" title="Surface elevation">Bayesian kriging and spatial prediction</a></li>
<li><a href="/examples/latest/spatial/Forest.html" title="Distribution of hickory trees in Duke forest">Poisson-gamma spatial moving average (convolution) model</a></li>
<li><a href="/examples/latest/spatial/Huddersfield.html" title="Ecological regression of air pollution and respiratory illness in children">Poisson-gamma spatial moving average (convolution) model</a></li>
<li><a href="/examples/latest/spatial/Shared.html" title="Oral cavity cancer and lung cancer in West Yorkshire (UK)">Shared component for mapping multiple diseases</a></li>
<li><a href="/examples/latest/spatial/Pollution.html">Random walk priors for temporal smoothing of daily air pollution estimates</a></li>
</ul>
</li>
<li class="nav-item"><a aria-expanded="true" class="dropdown-toggle nav-link" data-toggle="collapse" href="#reliability">ReliaBUGS</a>
<ul class="collapse" id="reliability">
<li><a href="/examples/latest/reliability/Vol.html">Contents</a></li>
<li><a href="/examples/latest/reliability/BS_Ex.html" title="'psi31' data from B&amp;S(1969)">Birnbuam-Saunders model</a></li>
<li><a href="/examples/latest/reliability/BurrX_Ex.html" title="'Ball bearing' data from Lawless(2003)">BurrX model</a></li>
<li><a href="/examples/latest/reliability/BurrXII_Ex.html" title="Simulated example ">BurrXII model</a></li>
<li><a href="/examples/latest/reliability/ExpoWeibull_Ex.html" title="Carbon Fibres data from Nichols and Padgett (2006) ">Two Parameter Exponentiated Weibull Example model</a></li>
<li><a href="/examples/latest/reliability/ExpPower_Ex.html" title="'Simulated data">Exponential Power model</a></li>
<li><a href="/examples/latest/reliability/Ext_exponential_Ex.html" title="'Carbon Fibres data' from Nichols and Padgett (2006)">Marshal-Olkin Extended Exponential (MOEE) model</a></li>
<li><a href="/examples/latest/reliability/Ext_Weibull_Ex.html" title="'Device failure times data' from Meeker and Escobar(1998)">Marshal-Olkin Extended Weibull model</a></li>
<li><a href="/examples/latest/reliability/FlexibleWeibull_Ex.html" title="'Reactor pump failure data' from Bebbinton, Lai, and Zitikis(2007)">Flexible Weibull model</a></li>
<li><a href="/examples/latest/reliability/GenExponential_Cen_Ex.html" title="'Ball bearing' data from Lawless(2003)">Censored Generalized Exponential model</a></li>
<li><a href="/examples/latest/reliability/Gompertz_Ex.html" title="Data from Murthy, Xie, and Jiang(2004)">Gompertz model</a></li>
<li><a href="/examples/latest/reliability/GPWeibull_Ex.html" title="'Carbon Fibres data' from Nichols and Padgett (2006) ">Two Parameter (GP) Exponentiated Weibull Example model</a></li>
<li><a href="/examples/latest/reliability/Gumbel_Ex.html" title="Data from Murthy, Xie, and Jiang(2004)">Gumbel model</a></li>
<li><a href="/examples/latest/reliability/Inv_Weibull_Ex.html" title="Data from Murthy, Xie, and Jiang(2004)">Inverse Weibull model</a></li>
<li><a href="/examples/latest/reliability/InvGaussian_Ex.html" title="'Transceiver data' from Chikara and Folks (9177)">Inverse Gaussian model</a></li>
<li><a href="/examples/latest/reliability/LinearFailure_Ex.html" title="Data from Murthy, Xie, and Jiang(2004)">Linear Failure Rate (LFR) model</a></li>
<li><a href="/examples/latest/reliability/LogisticExponential_Ex.html" title="'Naval logistics' data from Yan and Leemis (2008)">Logistic-Exponential model</a></li>
<li><a href="/examples/latest/reliability/Loglogistic_Ex.html" title="Simulated data">Log-Logistic model</a></li>
<li><a href="/examples/latest/reliability/LogWeibull_Ex.html" title="Data from Murthy, Xie, and Jiang(2004)">Log-Weibull model</a></li>
<li><a href="/examples/latest/reliability/ModifiedWeibull_Ex.html" title="Data from Aarset(1987)">Modified Weibull model</a></li>
<li><a href="/examples/latest/reliability/WeibullShifted_Ex.html" title="Simulated data">Weibull-shifted model</a></li>
</ul>
</li>
</li></li></li></li></ul>
</div>
</div></div><div class="col-12 col-md-9 col-lg-7 col-xl-6">


<p>
<h4>Change points: A piecewise differential equation model</h4>All of the previous examples have first derivatives which are smooth functions of time (i.e. the second derivatives, with respect to time, are all continuous). OpenBUGS is capable of handling situations where this is not the case but it requires additional information regarding the times at which discontinuities occur. It needs this information so that it can break up the problem<br/>into “blocks” of time where, throughout each block, all second derivatives are continuous. Because specifying such models is somewhat more complicated than with their smooth counterparts, OpenBUGS provides an additional BUGS-language component (ode.block) for solving these problems. The example from this section is also provided as a compiled component (DiffChangePoints).<br/><br/>Population PK Model<br/>Our model for this example is designed to illustrate several features of ‘advanced’ OpenBUGS use, such as the specification of population models, handling discontinuities in time, and allowing compartments to empty into each other. In pharmacokinetics, a population model is required when, in order to draw inferences about the target population, a study is conducted whereby a number of healthy volunteers or patients each receive one or more doses of the drug under investigation and concentration measurements are taken from each one. Typically we have a (parametric) structural model that describes the shape of the concentration-time profile and we model variability throughout the study population by allowing the parameters of that structural model to differ between individuals. The structural model for this example is shown in the figure.<br/><font color="#000100" face="CMR12" size="3"><br/>            <img alt="[changepoints1]" src="changepoints1.bmp"/><br/><br/></font>The human body is represented by a single compartment (“Compartment 1”) and as such is assumed to be homogeneous – the blood and all organs/tissues contain the same concentration of drug, C, which is given by the total amount of drug in the body at time t, A<font color="#000100" face="Arial" size="1">1 </font>= A<font color="#000100" face="Arial" size="1">1</font>(t), divided by an apparent volume of distribution, V . Drug is eliminated (or cleared) from the body via a ‘flow-rate’ of CL (clearance) – the rate of elimination, i.e. the rate at which drug leaves the body, is given by dA<sub>el</sub> / dt= CL¡ C = CL¡ A<sub>1</sub>/ V . Compartments 2 and 3 contain doses of drug to be administered, to Compartment 1, at times t = t<font color="#000100" face="Arial" size="1"><sub>b2</sub></font>and t = t<font color="#000100" face="Arial" size="1"><sub>zo</sub></font>, respectively. These have been incorporated purely for illustrative purposes – they are actually unnecessary as we could easily specify the model using Compartment 1 alone (with an appropriate sequence of initial conditions for each block of time). The full sequence of events that generates our model is described as follows. At time t = 0, the volunteer/patient receives an intravenous bolus dose <font color="#000100" face="Arial" size="1">1 </font>of size D. At time t = t<font color="#000100" face="Arial" size="1">b2 </font>&gt; 0 a second bolus, of the same size, is administered. This is the process represented by the dashed arrow from Compartments 2 to 1 in the figure – dashed arrows represent processes whereby one compartment empties into another instantaneously at the specified time (t = t<font color="#000100" face="Arial" size="1">b2 </font>in this case) whereas normal arrows denote rates of movement of drug. At time t = t<font color="#000100" face="Arial" size="1">zo </font>&gt; t<font color="#000100" face="Arial" size="1">b2 </font>a zero-order process is initiated between Compartments 3 and 1 whereby the dose initially in Compartment 3 (again, D) is transferred to Compartment 1 at a constant rate given by D/TI, where TI denotes the duration of the zero-order input process. Clearly this process must terminate at t = t<font color="#000100" face="Arial" size="1">zo </font>+ TI. All of this means that the somewhat abstract quantity R<font color="#000100" face="Arial" size="1">31 </font>in the figure , which simply represents the rate of movement of drug from Compartments 3 to 1, is a piecewise smooth function of time. Explicitly, it is given by<font color="#000100" face="CMR12" size="3"><br/><br/>      <img alt="[changepoints2]" src="changepoints2.bmp"/><br/></font>More generally, we can write R<font color="#000100" face="Arial" size="1">31 </font>= pw(v, o, t), where v and o are vectors containing each smooth function and the times at which they begin, respectively; in this case, v = (0, 0,D/TI, 0), o = (0, t<font color="#000100" face="Arial" size="1">b2</font>, t<font color="#000100" face="Arial" size="1">zo</font>, t<font color="#000100" face="Arial" size="1">zo </font>+TI) and pw = v<font color="#000100" face="Arial" size="1">b</font>, where b =X<font color="#000100" face="Arial" size="1">i </font>i I(t ∈ [o<font color="#000100" face="Arial" size="1">i</font>, o<font color="#000100" face="Arial" size="1">i+1</font>)) (o<font color="#000100" face="Arial" size="1">5 </font>= ∞), that is, b simply specifies which ‘block’ of time, defined by a pair of ‘changepoints’, contains the current value of t. OpenBUGS provides a new BUGSlanguage component called piecewise(.) that can be used for specifying arbitrary piecewise-smooth functions within differential equation models. Only the vector v is required as an input parameter, however. This is because the ‘origins’ in o are passed into the associated ode.block(.) component instead, so that it knows where to break the problem up into ‘smooth’ sub-problems (t is defined/controlled by the ODE solving algorithm). For this reason, the o vector passed into ode.block(.) must comprise the union of all ‘changepoints’ in the model and each instance of piecewise(.) must be defined in terms of a smooth function vector (v) of the same length. This is why R<font color="#000100" face="Arial" size="1">31 </font>above incorporates components for both [0, t<font color="#000100" face="Arial" size="1">b2</font>) and [t<font color="#000100" face="Arial" size="1">b2</font>, t<font color="#000100" face="Arial" size="1">zo</font>) even though it has the same value throughout both intervals: ode.block(.) needs to know that a discrete event occurs at t = t<font color="#000100" face="Arial" size="1">b2 </font>and so all of its piecewise parents (just R<font color="#000100" face="Arial" size="1">31 </font>in this case) must be ‘split’ accordingly.<br/><br/>The system equations are as follows:<br/><font color="#000100" face="CMR12" size="3">d</font><font color="#000100" face="CMMI12" size="3">A</font><font color="#000100" face="CMR8" size="1">1</font><font color="#000100" face="CMR12" size="3">/d</font><font color="#000100" face="CMMI12" size="3">t</font><font color="#000100" face="CMR12" size="3">= </font><font color="#000100" face="CMMI12" size="3">R</font><font color="#000100" face="CMR8" size="1">31</font><font color="#000100" face="CMR12" size="3">(</font><font color="#000100" face="CMMI12" size="3">t</font><font color="#000100" face="CMR12" size="3">) </font><font color="#000100" face="CMSY10" size="3">− </font><font color="#000100" face="CMMI12" size="3">CL </font><font color="#000100" face="CMMI12" size="3">A</font><font color="#000100" face="CMR8" size="1">1 </font><font color="#000100" face="CMMI12" size="3">/ V<br/>         <br/></font><font color="#000100" face="CMR12" size="3">d</font><font color="#000100" face="CMMI12" size="3">A</font><font color="#000100" face="CMR8" size="1">2</font><font color="#000100" face="CMR12" size="3">/d</font><font color="#000100" face="CMMI12" size="3">t </font><font color="#000100" face="CMR12" size="3">= 0<br/>         <br/></font><font color="#000100" face="CMR12" size="3">d</font><font color="#000100" face="CMMI12" size="3">A</font><font color="#000100" face="CMR8" size="1">3</font><font color="#000100" face="CMR12" size="3">/</font><font color="#000100" face="CMR12" size="3">d</font><font color="#000100" face="CMMI12" size="3">t </font><font color="#000100" face="CMR12" size="3">= </font><font color="#000100" face="CMSY10" size="3">−</font><font color="#000100" face="CMMI12" size="3">R</font><font color="#000100" face="CMR8" size="1">31</font><font color="#000100" face="CMR12" size="3">(</font><font color="#000100" face="CMMI12" size="3">t</font><font color="#000100" face="CMR12" size="3">)<br/>         <br/></font>(Note that neither bolus dose is represented in the system equations. This is because bolus doses are instantaneous and are thus best described via the initial conditions, as we discuss below.) The structural model is completed by the specification of a sequence of initial conditions for each compartment. First in the sequence are the initial conditions proper, which pertain to the time origin given by o<font color="#000100" face="Arial" size="1">1</font>. Note that the easiest way in which to model the first intravenous bolus dose is to simply specify A<font color="#000100" face="Arial" size="1">1</font>(o<font color="#000100" face="Arial" size="1">1</font>) = A<font color="#000100" face="Arial" size="1">1</font>(0) = D in the initial conditions. At each subsequent origin (e.g. o<font color="#000100" face="Arial" size="1">2</font>, o<font color="#000100" face="Arial" size="1">3</font>, o<font color="#000100" face="Arial" size="1">4</font>) we may, generally speaking, wish to apply an instantaneous adjustment to the system to account for certain types of discrete event that may have occurred, such as the administration of a bolus dose (which cannot be represented by a finite rate). In OpenBUGS we specify such adjustments by declaring an amount (of whatever quantity the differential equations are to be solved for) to be added to each compartment at the appropriate time. If no adjustment is specified (or if a value of zero is declared) then the relevant part of the system is left unchanged. Thus for the example above, we specify the following matrix of ‘initial conditions’, where rows correspond to origins (o<font color="#000100" face="Arial" size="1">1</font>, o<font color="#000100" face="Arial" size="1">2</font>, o<font color="#000100" face="Arial" size="1">3</font>, o<font color="#000100" face="Arial" size="1">4</font>) and the columns represent compartments:<br/><font color="#000100" face="CMR12" size="3"><br/>               <img alt="[changepoints3]" src="changepoints3.bmp"/><br/></font>The −A<font color="#000100" face="Arial" size="1">2 </font>in column 2 represents the change to the solution to the second differential equation at the relevant time, i.e. t = t<font color="#000100" face="Arial" size="1">b2 </font>(the second ‘origin’). Thus the amount of drug in Compartment 2 instantaneously changes from A<font color="#000100" face="Arial" size="1">2</font>(t<font color="#000100" face="Arial" size="1">b2−</font>) to zero at t = t<font color="#000100" face="Arial" size="1">b2 </font>(because its value is reduced by A<font color="#000100" face="Arial" size="1">2</font>(t<font color="#000100" face="Arial" size="1">b2−</font>)). In contrast, the amount of drug in Compartment 1 changes from A<font color="#000100" face="Arial" size="1">1</font>(t<font color="#000100" face="Arial" size="1">b2−</font>) to A<font color="#000100" face="Arial" size="1">1</font>(t<font color="#000100" face="Arial" size="1">b2−</font>)+A<font color="#000100" face="Arial" size="1">2</font>(t<font color="#000100" face="Arial" size="1">b2−</font>). In other words, Compartment 2 instantaneously empties into Compartment 1 at time t = t<font color="#000100" face="Arial" size="1">b2</font>. Since Compartment 2 initially contains an amount D of drug and <font color="#000100" face="Arial" size="1">dA</font><font color="#000100" face="Arial" size="1">2 </font><font color="#000100" face="Arial" size="1">dt </font>≡ 0, this is equivalent to an intravenous bolus dose being administered, to Compartment 1, at t = t<font color="#000100" face="Arial" size="1">b2</font>. The statistical model is defined as follows. First note that the measurable quantity here is concentration of drug in Compartment 1, i.e. C = A<font color="#000100" face="Arial" size="1">1</font>/V . This is a function of the dose D, time t, and additional parameters, namely CL, V and TI, that we collectively denote by : C = C(, t,D). For this example we will allow both and D to vary between individuals, although the doses are assumed known, as they would be in practice (normally). Suppose we have n concentration measurements, indexed by j, from each of K individuals, indexed by i. We denote these by y<font color="#000100" face="Arial" size="1">ij </font>, i = 1, ...,K, j = 1, ..., n. Often in pharmacokinetics, the size of the error associated with each concentration measurement is proportional to the underlying true concentration and so we tend to model the natural logarithm of the data as a function of log C. At the first stage of the statistical model we assume<br/><br/>   log y<font color="#000100" face="Arial" size="1">ij </font>= log C(<font color="#000100" face="Arial" size="1">i</font>, t<font color="#000100" face="Arial" size="1">ij </font>,D<font color="#000100" face="Arial" size="1">i</font>) + e<font color="#000100" face="Arial" size="1">ij </font>, i = 1, ...,K, j = 1, ..., n,<br/><br/>where t<font color="#000100" face="Arial" size="1">ij </font>denotes the time at which y<font color="#000100" face="Arial" size="1">ij </font>was collected and the e<font color="#000100" face="Arial" size="1">ij </font>terms are independent and identically distributed normal random variables with mean zero and variance t<font color="#000100" face="Arial" size="1"><sup>−1</sup></font>(i.e. precision = t). At the second stage of the model we have<br/><br/>   Q<font color="#000100" face="Arial" size="1">i ~</font> MVN<font color="#000100" face="Arial" size="1">3</font>(m,Ω), i = 1, ...,K,<br/>   <br/>where and Ω are the population mean and the variance-covariance of pharmacokinetic<br/>parameters, respectively. At the final stage of our population model, appropriate multivariate normal, Wishart and gamma priors are specified for m, Ω<font color="#000100" face="Arial" size="1"><sup>−1</sup></font>and t, respectively.In the BUGS language the model is<br/>model {<br/>for (i in 1:n.ind) {<br/>for (j in 1:n.grid) {<br/>   log.data[i, j] ~ dnorm(log.model[i, j], tau)<br/>   log.model[i, j] &lt;- log(model[i, j])<br/>   model[i, j] &lt;- solution[i, j, 1] / V[i]}<br/>   solution[i, 1:n.grid, 1:dim] &lt;- ode.block(inits[i, 1:2, 1:dim], <br/>      grid[1:n.grid], D(A[i, 1:dim], t[i]), origins[i, 1:n.block], tol[])<br/>            <br/>      D(A[i, 1], t[i]) &lt;- R31[i] - CL[i] * A[i, 1] / V[i]<br/>D(A[i, 2], t[i]) &lt;- 0<br/>D(A[i, 3], t[i]) &lt;- -R31[i]<br/>R31[i] &lt;- piecewise(vec.R31[i, 1:n.block])<br/>vec.R31[i, 1] &lt;- 0<br/>vec.R31[i, 2] &lt;- 0<br/>vec.R31[i, 3] &lt;- dose[i] / TI[i]<br/>vec.R31[i, 4] &lt;- 0<br/>      <br/>CL[i] &lt;- exp(theta[i, 1])<br/>V[i] &lt;- exp(theta[i, 2])<br/>TI[i] &lt;- exp(theta[i, 3])<br/>      <br/>theta[i, 1:p] ~ dmnorm(mu[1:p], omega.inv[1:p, 1:p])<br/><br/>inits[i, 1, 1] &lt;- dose[i]<br/>inits[i, 1, 2] &lt;- dose[i]<br/>inits[i, 1, 3] &lt;- dose[i]<br/>inits[i, 2, 1] &lt;- A[i, 2]<br/>inits[i, 2, 2] &lt;- -A[i, 2]<br/>      <font color="#FF80FF" face="Arial" size="3">inits[i, 2, 3] &lt;- 0</font><span class="button"><br/>         </span><br/>origins[i, 1] &lt;- 0<br/>origins[i, 2] &lt;- second.bolus.time<br/>origins[i, 3] &lt;- zo.start.time<br/>origins[i, 4] &lt;- zo.start.time + TI[i]<br/>}<br/><br/>#hyper priors<br/>mu[1:p] ~ dmnorm(mu.prior.mean[1:p], mu.prior.prec[1:p, 1:p])<br/>omega.inv[1:p, 1:p] ~ dwish(omega.inv.matrix[1:p, 1:p], omega.inv.dof)<br/>omega[1:p, 1:p] &lt;- inverse(omega.inv[1:p, 1:p])<br/>tau ~ dgamma(0.001, 0.001)<br/>}<br/><br/><a href="/examples/latest/ChangePointsdata.html"></a><div><h5>Data</h5><details><code>
list(<br/>p = 3, dim = 3,<br/>tol = c(1.0E-6),<br/>n.ind = 10, n.grid = 14, n.block = 4,<br/>grid = c(0.05, 0.1, 0.2, 0.4, 0.6, 1.0, 1.5, 2, 3, 4, 8, 12, 16, 24),<br/>dose = c(100, 95, 90, 85, 80, 75, 70, 65, 60, 55),<br/>second.bolus.time = 2, zo.start.time = 8,<br/>mu.prior.mean = c(1, 2, 0),<br/>mu.prior.prec = structure(<br/>.Data = c(<br/>0.0001, 0, 0,<br/>0, 0.0001, 0,<br/>0, 0, 0.0001),<br/>.Dim = c(3, 3)),<br/>omega.inv.matrix = structure(<br/>.Data = c(<br/>0.03, 0, 0,<br/>0, 0.03, 0,<br/>0, 0, 0.03),<br/>.Dim = c(3, 3)),<br/>omega.inv.dof = 3,<br/>log.data = structure(.Data = c(<br/>2.506806978030932,2.67682296697279,2.332344283466289,2.376797675013539,2.349437440647516,<br/>2.277130759053128,1.901860129713161,3.036587520038876,2.526992373680701,2.190055870390162,<br/>0.4449995864259541,1.353024467696517,-0.5667546851524111,-4.133111399218143,2.390654845171341,<br/>2.36628605709322,2.509243513218112,2.465580984239555,2.221587392910886,2.26140091802353,<br/>2.022032460326893,2.902317217812296,2.826183340878527,2.330718926280069,1.062163350686548,<br/>1.500236604866249,0.322568880365175,-2.181050407630254,2.611914512120249,2.883165921662452,<br/>2.429170613111546,2.215920703420093,2.378618333260171,2.330850077921749,1.9400991031341,<br/>2.997631153082918,2.463878538194495,2.047968734726723,0.04743993646881008,1.284096469794026,<br/>-0.7398765567482091,-4.587268506000238,2.471564694054391,2.55457452585859,2.51053369355437,<br/>2.445601815485881,2.332586545255321,2.27456950478153,1.924626801063482,2.969193779197737,<br/>2.506648460779211,2.222627824352776,0.9672690836791722,1.515413378340901,-0.04569181083533707,<br/>-2.851486982778233,2.539293637668727,2.398059641335746,2.487736938488076,2.417431956872954,<br/>2.260453379438979,2.064163201395757,1.814923115123572,2.863839983473093,2.536987551662465,<br/>1.894732020180357,0.4325342799713265,1.055818719029957,-0.5579776651291811,-3.960966950975292,<br/>2.226371502748412,2.191840043848823,2.279424083468609,2.056444497385586,2.311028713158125,<br/>2.058186176763404,1.827993924087064,2.619010913962962,2.389344703055091,1.970395837627473,<br/>0.2413104161259808,1.072668119978947,-0.6058328166918296,-4.003029763710348,2.236888305958121,<br/>2.135062810482048,2.240221834175653,2.238166789507332,2.051144568424816,2.125714628687647,<br/>1.923572098771534,2.807724904902176,2.401660929411848,1.837296700936244,0.659206626615328,<br/>1.115301201611678,-0.4423792045446207,-3.406416630637941,2.211440120423609,2.23046483176955,<br/>2.018914994730106,2.182643825114167,1.954370939817629,1.871286852494042,1.714155894212324,<br/>2.486776385476569,2.164408419240227,1.834279980037531,0.6084940510417839,1.199197322551877,<br/>-0.1166948465538084,-2.762398711280877,1.875653241701553,2.06996838022167,2.081126541408105,<br/>1.87731746628071,2.05746251568549,1.789223884031489,1.742538619368961,2.58637307440882,<br/>2.113607322799953,2.000086619244659,0.6879108524396829,1.221886907538273,-0.07662892171523605,<br/>-2.38190914914214,1.931313644642539,2.168130198912237,1.893274133179755,1.76215896822434,<br/>1.959281090819101,1.842555355403463,1.315750013216379,2.461529321627873,2.103280029469549,<br/>1.724961667718873,0.2738641523356443,0.7701139508282926,-0.7401336981314417,-3.294012374603819),<br/>.Dim = c(10,14))<br/>)
</code></details></div><a href="/examples/latest/ChangePointsinits.html"></a><div><h5>Inits for chain 1</h5><code>
list(<br/>tau = 100,<br/>mu = c(1, 2, 0),<br/>omega.inv = structure(<br/>.Data = c(<br/>100, 0, 0,<br/>0, 100, 0,<br/>0, 0, 100),<br/>.Dim = c(3, 3)),<br/>theta = structure(<br/>.Data = c(<br/>1, 2, 0,<br/>1, 2, 0,<br/>1, 2, 0,<br/>1, 2, 0,<br/>1, 2, 0,<br/>1, 2, 0,<br/>1, 2, 0,<br/>1, 2, 0,<br/>1, 2, 0,<br/>1, 2, 0),<br/>.Dim = c(10, 3))<br/>)
</code></div>    <a href="/examples/latest/ChangePointsinits1.html"></a><div><h5>Inits for chain 2</h5><code>
list(<br/>tau = 10,<br/>mu = c(0.1, 0.2, 1.0),<br/>omega.inv = structure(<br/>.Data = c(<br/>10.0, 0, 0,<br/>0, 1.00, 0,<br/>0, 0, 10.0),<br/>.Dim = c(3, 3)),<br/>theta = structure(<br/>.Data = c(<br/>0.1, 0.2,1.0,<br/>0.1, 0.2, 1.0,<br/>0.1, 0.2, 1.0,<br/>0.1,0.2, 1.0,<br/>0.1, 0.2,1.0,<br/>0.1,0.2, 1.0,<br/>0.1, 0.2,1.0,<br/>0.1,0.2, 1.0,<br/>0.1, 0.2, 1.0,<br/>0.1, 0.2, 1.0),<br/>.Dim = c(10, 3))<br/>)
</code></div><br/><font color="#0000FF" face="Arial" size="5">Results</font></p><center><font color="#000100" face="Arial" size="2"><br/><img alt="[changepoints4]" src="changepoints4.bmp"/><br/></font></center><font color="#0000FF" face="Arial" size="5"><strong>Data (simulation):</strong></font><br/>list(<br/>p = 3, dim = 3,<br/>tol = 1.0E-6,<br/>n.ind = 10, n.grid = 14, n.block = 4,<br/>grid = c(0.05, 0.1, 0.2, 0.4, 0.6, 1.0, 1.5, 2, 3, 4, 8, 12, 16, 24),<br/>dose = c(100, 95, 90, 85, 80, 75, 70, 65, 60, 55),<br/>second.bolus.time = 2, zo.start.time = 8,<br/>tau = 100,<br/>mu = c(1, 2, 0),<br/>omega.inv = structure(<br/>.Data = c(<br/>100, 0, 0,<br/>0, 100, 0,<br/>0, 0, 100),<br/>.Dim = c(3, 3))<br/>)<br/><br/><br/><font color="#000100" face="Arial" size="2"><strong>      mean   median   sd   MC_error   val2.5pc   val97.5pc   start   sample   ESS<br/></strong></font><font color="#000100" face="Arial" size="2">   mu[1]   0.9608   0.961   0.04307   8.031E-4   0.876   1.046   2001   10000   2875<br/>   mu[2]   1.946   1.946   0.03179   5.681E-4   1.884   2.01   2001   10000   3131<br/>   mu[3]   -0.1812   -0.1489   0.2566   0.021   -0.8321   0.2276   2001   10000   149<br/>   omega[1,1]   0.01739   0.01478   0.01029   1.676E-4   0.006415   0.04353   2001   10000   3773<br/>   omega[1,2]   -0.003268   -0.002778   0.005045   7.311E-5   -0.0151   0.005247   2001   10000   4761<br/>   omega[1,3]   0.01512   0.008399   0.02672   0.001462   -0.01356   0.08375   2001   10000   333<br/>   omega[2,1]   -0.003268   -0.002778   0.005045   7.311E-5   -0.0151   0.005247   2001   10000   4761<br/>   omega[2,2]   0.008861   0.007541   0.005261   7.351E-5   0.003257   0.02278   2001   10000   5121<br/>   omega[2,3]   -0.005532   -0.002809   0.01437   5.538E-4   -0.03858   0.01257   2001   10000   673<br/>   omega[3,1]   0.01512   0.008399   0.02672   0.001462   -0.01356   0.08375   2001   10000   333<br/>   omega[3,2]   -0.005532   -0.002809   0.01437   5.538E-4   -0.03858   0.01257   2001   10000   673<br/>   omega[3,3]   0.07787   0.03082   0.1504   0.009145   0.004836   0.4485   2001   10000   270<br/>   tau   93.99   93.5   12.33   0.234   71.31   119.8   2001   10000   2774<br/></font><br/><br/>

<p></p>


</div><div class="d-none d-lg-block col-lg-3 col-xl-3" id="onthispage"><div class="sticky-top stickymenu"><h5>On this page</h5></div></div></div></div></body></html>